{% extends "base.html" %}

{% block title %}–ö–Ω–∏–≥–∞ —Ä–µ—Ü–µ–ø—Ç–æ–≤ - –ì–ª–∞–≤–Ω–∞—è{% endblock %}

{% block content %}
<div class="card">
    <h1>üç≥ –ö–Ω–∏–≥–∞ —Ä–µ—Ü–µ–ø—Ç–æ–≤</h1>
    <p style="text-align: center; font-size: 1.2em; color: #666; margin-bottom: 30px;">
        –í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ—Ü–µ–ø—Ç –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–µ—Ä—Å–æ–Ω –¥–ª—è –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è
    </p>

    <div id="recipes-container">
        <div class="recipe-selector" id="recipe-list">
            <!-- –†–µ—Ü–µ–ø—Ç—ã –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
        </div>
    </div>
</div>

<script>
// –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ —Ä–µ—Ü–µ–ø—Ç–æ–≤ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
document.addEventListener('DOMContentLoaded', function() {
    loadRecipes();
});

async function loadRecipes() {
    try {
        const response = await fetch('/api/recipes');
        const recipes = await response.json();

        const recipeList = document.getElementById('recipe-list');
        recipeList.innerHTML = '';

        recipes.forEach(recipe => {
            const recipeCard = document.createElement('div');
            recipeCard.className = 'recipe-card';
            recipeCard.onclick = () => selectRecipe(recipe.id, recipe.name);

            recipeCard.innerHTML = `
                <h3>${recipe.name}</h3>
                <p>–ë–∞–∑–æ–≤–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Ä—Ü–∏–π: ${recipe.base_servings}</p>
                <p style="font-size: 0.9em; opacity: 0.8;">–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞</p>
            `;

            recipeList.appendChild(recipeCard);
        });
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–µ—Ü–µ–ø—Ç–æ–≤:', error);
        document.getElementById('recipe-list').innerHTML = 
            '<p style="text-align: center; color: #e74c3c;">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–µ—Ü–µ–ø—Ç–æ–≤</p>';
    }
}

function selectRecipe(recipeId, recipeName) {
    // –°–æ–∑–¥–∞–µ–º —Ñ–æ—Ä–º—É –¥–ª—è –≤–≤–æ–¥–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø–µ—Ä—Å–æ–Ω
    const recipesContainer = document.getElementById('recipes-container');

    recipesContainer.innerHTML = `
        <div class="card" style="text-align: center;">
            <h2>–í—ã –≤—ã–±—Ä–∞–ª–∏: ${recipeName}</h2>
            <div class="servings-input">
                <label for="servings">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–µ—Ä—Å–æ–Ω:</label>
                <input type="number" id="servings" min="1" max="20" value="4" />
                <button onclick="goToRecipe(${recipeId})">–ü–æ–∫–∞–∑–∞—Ç—å —Ä–µ—Ü–µ–ø—Ç</button>
            </div>
            <button onclick="location.reload()" style="background: #95a5a6; margin-top: 15px;">
                –í—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥–æ–π —Ä–µ—Ü–µ–ø—Ç
            </button>
        </div>
    `;

    // –§–æ–∫—É—Å –Ω–∞ –ø–æ–ª–µ –≤–≤–æ–¥–∞
    document.getElementById('servings').focus();

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ Enter –≤ –ø–æ–ª–µ –≤–≤–æ–¥–∞
    document.getElementById('servings').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            goToRecipe(recipeId);
        }
    });
}

function goToRecipe(recipeId) {
    const servings = document.getElementById('servings').value;
    if (servings && servings > 0) {
        window.location.href = `/recipe/${recipeId}?servings=${servings}`;
    } else {
        alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–µ—Ä—Å–æ–Ω');
    }
}
</script>
{% endblock %}
